///////////////////////////////////////////////////////////////////////////////
/// @file   State.hpp
/// @author Jacob Adkins (jpadkins)
/// @brief  Global singleton class containing references to different
///         management classes for the roguelike game and the root class for
///         update() and draw() calls
///////////////////////////////////////////////////////////////////////////////

#ifndef ROGUELIKE__STATE_HPP
#define ROGUELIKE__STATE_HPP

///////////////////////////////////////////////////////////////////////////////
/// Headers
///////////////////////////////////////////////////////////////////////////////

#include <memory>
#include <SFML/System.hpp>
#include <SFML/Graphics.hpp>

#include "Common.hpp"

///////////////////////////////////////////////////////////////////////////////
/// Forward declarations for State
///////////////////////////////////////////////////////////////////////////////
class DebugManager;
class WindowManager;

///////////////////////////////////////////////////////////////////////////////
/// @brief Singleton holding references to different management classes
///////////////////////////////////////////////////////////////////////////////
class State : public sf::Drawable {
public:

    ///////////////////////////////////////////////////////////////////////////
    /// @brief Disable copy constructor
    ///////////////////////////////////////////////////////////////////////////
    State(const State&) = delete;

    ///////////////////////////////////////////////////////////////////////////
    /// @brief Disable assignment operator
    ///////////////////////////////////////////////////////////////////////////
    void operator=(const State&) = delete;

    ///////////////////////////////////////////////////////////////////////////
    /// @brief Returns a reference to the global State instance
    ///
    /// @return A reference to the global State instance
    ///////////////////////////////////////////////////////////////////////////
    static State& get();

    ///////////////////////////////////////////////////////////////////////////
    /// @brief Updates all private management classes
    ///////////////////////////////////////////////////////////////////////////
    void update();

    ///////////////////////////////////////////////////////////////////////////
    sf::Font font;
    sf::Int32 deltaMs = 0;
    bool showDebug = false;
    bool leftClick = false;
    bool rightClick = false;
    sf::Vector2i mousePosition = {0,0};
    sf::Vector2i lastMousePosition = {0,0};
    std::unique_ptr<WindowManager> windowManager;

private:

    ///////////////////////////////////////////////////////////////////////////
    /// @brief Private constructor
    ///////////////////////////////////////////////////////////////////////////
    State();

    ///////////////////////////////////////////////////////////////////////////
    /// @brief Overloaded draw function from sf::Drawable/sf::Transformable
    ///
    /// The draw call passes through to all managed objects, rendering a frame
    ///////////////////////////////////////////////////////////////////////////
    void draw(sf::RenderTarget& target, sf::RenderStates) const override;

    std::unique_ptr<DebugManager> m_debugManager;
};

#endif
